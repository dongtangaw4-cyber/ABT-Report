<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ | ABT Report</title>
  <link rel="icon" href="icon192.png">
  <link rel="apple-touch-icon" href="icon512.png">
  <style>
   html, body {
      height: 100%;
      margin: 0;
      font-family: 'Kanit', system-ui;
      background: url('Background‡∏ò‡∏µ‡∏°.png') center center / cover no-repeat fixed;
    }
    body{font-family:Kanit,system-ui;max-width:800px;margin:24px auto;padding:0 16px}
    .row{display:flex;gap:8px;align-items:center}
    input{flex:1;padding:10px;border:1px solid #ddd;border-radius:10px}
    button{padding:10px 14px;border:0;border-radius:10px;background:#16a34a;color:#fff;cursor:pointer}
    .card{margin-top:14px;padding:12px;border:1px solid #eee;border-radius:12px;background:#fff}
    img{max-width:160px;border-radius:8px;margin-top:6px}
  
	.status-tag {
	display: inline-block;
	padding: 4px 10px;
	border-radius: 999px;
	font-size: 14px;
	font-weight: 600;
	color: #fff;
	}

	/* ‡∏™‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ */
	.s-‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß {
	background-color: #0ea5e9; /* üíô ‡∏ü‡πâ‡∏≤‡∏™‡∏î */
	}

	.s-‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ {
	background-color: #facc15; /* ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á */
	color: #000;
	}

	.s-‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô {
	background-color: #16a34a; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
	}
  </style>
</head>
<body>
   <button onclick="window.history.back()"
    style="
    position: fixed;
    top: 20px;
    left: 20px;
    background-color: #16a34a;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Kanit', sans-serif;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
   ">
   ‚¨ÖÔ∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
</button>
  <h2>üîé ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h2>
  <div class="row">
    <input id="q" placeholder="‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ ‡∏´‡∏£‡∏∑‡∏≠ 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á">
    <button id="btnSearch">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
  </div>
  <div id="result" style="margin-top:12px;color:#555"></div>

  <!-- ‡πÇ‡∏Ñ‡πâ‡∏î JS ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import {
      getFirestore, collection, query, where, orderBy, limit, getDocs
    } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";

    // --- Firebase config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ---
    const firebaseConfig = {
      apiKey: "AIzaSyDR8hVqZ1uDrjRMjK6u_rWO6c7Cs5-vDXw",
      authDomain: "abt-report.firebaseapp.com",
      projectId: "abt-report",
      storageBucket: "abt-report.appspot.com",
      messagingSenderId: "166748459797",
      appId: "1:166748459797:web:0cf5693e43a551142a8f1c"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    await signInAnonymously(auth);

    const ipt = document.getElementById('q');
    const btn = document.getElementById('btnSearch');
    const out = document.getElementById('result');

    btn.addEventListener('click', doSearch);

    async function doSearch(){
      const kw = (ipt.value || '').trim();
      if(!kw){ out.textContent = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô'; return; }
      out.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...';

      try{
        // ‡∏Ñ‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÄ‡∏ï‡πá‡∏°‡∏´‡∏£‡∏∑‡∏≠ 4 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢ (‡πÉ‡∏ä‡πâ where + range)
        let qRef = query(
          collection(db,'reports'),
          orderBy('phone'),
          where('phone','>=',kw),
          where('phone','<=',kw + '\uf8ff'),
          limit(50)
        );

        const snap = await getDocs(qRef);
        if(snap.empty){ out.textContent = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'; return; }

        out.innerHTML = [...snap.docs].map(d=>{
          const r = d.data();
          return `
            <div class="card">
              <div><b>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</b> ${r.name||'-'}</div>
              <div><b>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</b> ${r.category||'-'}</div>
              <div><b>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</b> ${r.detail||'-'}</div>
              <div><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</b> ${r.status||'-'}</div>
			  <span style="padding:1px 3px;border-radius:800px;
              background:${(r.status||'')==='‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'?'#16a34a':'#fbbf24'};
              color:#fff">${r.status||'-'}</span>
              ${r.lat && r.lng ? `<div><b>‡∏û‡∏¥‡∏Å‡∏±‡∏î:</b> ${r.lat}, ${r.lng}</div>`:''}
              ${r.photo ? `<img src="${r.photo}" alt="‡∏£‡∏π‡∏õ‡πÅ‡∏ô‡∏ö">` : ''}
			  ${r.lat&&r.lng?`<a target="_blank" href="https://maps.google.com/?q=${r.lat},${r.lng}">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</a>`:''}
            </div>`;
        }).join('');
      }catch(err){
        out.textContent = '‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + err.message;
        console.error(err);
      }
    }
	
	
  </script>
</body>
</html>